# Engram — Portainer Stack (single gateway service)
# Deploy as a Portainer stack or with: docker compose up -d
#
# Secrets (Slack, Google, Ollama, etc.) are loaded automatically from
# the .env file inside the mounted config directory — no need to pass
# them as Docker env vars.

services:
  engram:
    build:
      context: .
      dockerfile: Dockerfile
    image: engram:latest
    container_name: engram
    environment:
      HOME: /home/node
      TERM: xterm-256color
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN}
    volumes:
      - ${OPENCLAW_CONFIG_DIR:-./config}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR:-./workspace}:/home/node/.openclaw/workspace
      - engram_home:/home/node
    ports:
      - "${OPENCLAW_GATEWAY_PORT:-18789}:18789"
    init: true
    restart: unless-stopped
    command:
      - "node"
      - "dist/index.js"
      - "gateway"
      - "--bind"
      - "lan"
      - "--port"
      - "18789"

volumes:
  engram_home:
